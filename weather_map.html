<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css' rel='stylesheet'/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

</head>
<body>

<!--navbar-->
<nav class="navbar bg-primary text-light">Weather App<span id="current-city">city name</span></nav>

<div>
    <div class="mb-2 ml-2">
        <label for="place" class="sr-only">Place</label>
        <input type="text" readonly class="form-control-plaintext" id="place" value="place">
    </div>
    <div class="mx-sm-3 mb-2">
        <label for="input-place" class="sr-only">Submit</label>
        <input type="text" class="form-control" id="input-place">
    </div>
    <button type="submit" id="submit" class="btn btn-primary mb-2">Submit</button>
</div>
<!--cards with weather info-->
<div class="row justify-content-center" id="weather">
<!--    <div class="col-sm-2">-->
<!--        <div class="card" style="width: 18rem;">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-title">date</h6>-->
<!--                <hr>-->
<!--                <h6 class="card-text">Description:</h6>-->
<!--                <h6 class="card-text">Humidity:</h6>-->
<!--                <h6 class="card-text">Wind:</h6>-->
<!--                <h6 class="card-text">Pressure:</h6>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-sm-2">-->
<!--        <div class="card" style="width: 18rem;">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-title">date</h6>-->
<!--                <hr>-->
<!--                <h6 class="card-text">Description:</h6>-->
<!--                <h6 class="card-text">Humidity:</h6>-->
<!--                <h6 class="card-text">Wind:</h6>-->
<!--                <h6 class="card-text">Pressure:</h6>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-sm-2">-->
<!--        <div class="card" style="width: 18rem;">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-title">date</h6>-->
<!--                <hr>-->
<!--                <h6 class="card-text">Description:</h6>-->
<!--                <h6 class="card-text">Humidity:</h6>-->
<!--                <h6 class="card-text">Wind:</h6>-->
<!--                <h6 class="card-text">Pressure:</h6>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-sm-2">-->
<!--        <div class="card" style="width: 18rem;">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-title">date</h6>-->
<!--                <hr>-->
<!--                <h6 class="card-text">Description:</h6>-->
<!--                <h6 class="card-text">Humidity:</h6>-->
<!--                <h6 class="card-text">Wind:</h6>-->
<!--                <h6 class="card-text">Pressure:</h6>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="col-sm-2">-->
<!--        <div class="card" style="width: 18rem;">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-title">date</h6>-->
<!--                <hr>-->
<!--                <h6 class="card-text">Description:</h6>-->
<!--                <h6 class="card-text">Humidity:</h6>-->
<!--                <h6 class="card-text">Wind:</h6>-->
<!--                <h6 class="card-text">Pressure:</h6>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
</div>


<!--map-->
<div id='map' class="mt-2" style='width: 100%; height: 500px;'></div>
<!--jquery and keys-->
<script src="js/keys.js"></script>
<script src="js/jquery-2.2.4.js"></script>
<!--mapbox and weather js-->
<script>
    'use strict';
    // map config
    mapboxgl.accessToken = mapboxKey;
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        center: [-97.7431, 30.2672],
        zoom: 9,
    });
    // adding marker
    var marker = new mapboxgl.Marker()
        .setLngLat([-97.7431, 30.2672])
        .addTo(map)
        .setDraggable(true);
    // getting lng and lat of marker
    function onDragEnd () {
        reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
                    $('#current-city').text(results);
                    console.log(results);
                });
    }
    marker.on('dragend', function () {
            onDragEnd();
            // $('#current-city').text(reverseGeocode(marker.getLngLat(), mapboxKey));
        var lngLat = marker.getLngLat();
        var weatherOptions = {
            lat: lngLat.lat,
            lon: lngLat.lon,
            appid: OPEN_WEATHER_APPID,
            exclude: 'minutely, current, hourly',
            units: 'imperial'

        };
        $('#weather').html('');
        locationWeather();
    });
    // geocode and reverse geocode function
    function geocode(search, token) {
        var baseUrl = 'https://api.mapbox.com';
        var endPoint = '/geocoding/v5/mapbox.places/';
        return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
            .then(function(res) {
                return res.json();
                // to get all the data from the request, comment out the following three lines...
            }).then(function(data) {
                return data.features[0].center;
            });
    }
    function reverseGeocode(coordinates, token) {
        var baseUrl = 'https://api.mapbox.com';
        var endPoint = '/geocoding/v5/mapbox.places/';
        return fetch(baseUrl + endPoint + coordinates.lng + "," + coordinates.lat + '.json' + "?" + 'access_token=' + token)
            .then(function(res) {
                return res.json();
            })
            // to get all the data from the request, comment out the following three lines...
            .then(function(data) {
                return data.features[0].place_name;
            });
    }
    // $('#current-city').on('dragend', function () {
    //     reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
    //         // logs the address for The Alamo
    //         console.log(results);
    //     });
    // });
    reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
                // logs the address for The Alamo
                console.log(results);
            });
    // getting the value of search input
    var searchInput = $('#input-place').keyup(function() {
        var value = $(this).val();
    });
    // geocoding search
    $('#submit').click(function () {
    geocode(searchInput.val(), mapboxKey).then(function(results) {
          // do something with results
        console.log(results);
        console.log(results[0]);
        map.setCenter(results);
        marker.setLngLat(results);
        map.setZoom(9);
        reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
            $('#current-city').text(results);
            console.log(results);
        });
        $('#weather').html('');
        var weatherUrl = 'https://api.openweathermap.org/data/2.5/onecall';
        var weatherOptions = {
            lat: results[1],
            lon: results[0],
            appid: OPEN_WEATHER_APPID,
            exclude: 'minutely, current, hourly',
            units: 'imperial'

        };

        $.get(weatherUrl, weatherOptions).done(function (data) {
            console.log(data);
            var cData = '';
            // console.log(data);
            $.each(data.daily, function (index, value) {
                // console.log(index, value, 'test');
                var date = new Date(value.dt * 1000);
                var description = value.weather[0].description;
                var humidity = value.humidity;
                var wind = value.wind_speed;
                var pressure = value.pressure;
                if (index === 5) {
                    return false
                }
                cData += "<div class='col-sm-2'>";
                cData += "<div class='card'>";
                cData += "<div class='card-body'>";
                cData += "<h6 class='card-title'>" + date + "</h6>";
                cData += "<hr>";
                cData += "<h6 class='card-text'>" + description + "</h6>";
                cData += "<h6 class='card-text'>" + 'Humidity: ' + humidity + "</h6>";
                cData += "<h6 class='card-text'>" + 'Wind: ' + wind + "</h6>";
                cData += "<h6 class='card-text'>" + 'Pressue: ' + pressure + "</h6>";
                cData += "</div>";
                cData += "</div>";
                cData += "</div>";
                // console.log(cData)
            });

            $('#weather').append(cData);


            // var date = new Date(data.daily[0].dt * 1000);
            // console.log(date.toLocaleString());
            // console.log(data.daily[0].weather[0].description);
            // console.log(data.daily[0].humidity);
            // console.log(data.daily[0].wind_speed);
            // console.log(data.daily[0].pressure);
        });
        });
      });

    // weather js

    // var weatherUrl = 'https://api.openweathermap.org/data/2.5/onecall';
    // var weatherOptions = {
    //     lat: 30.2672,
    //     lon: -97.7431,
    //     appid: OPEN_WEATHER_APPID,
    //     exclude: 'minutely, current, hourly',
    //     units: 'imperial'
    //
    // };
    starterWeather();

     function locationWeather () {
         var lngLat = marker.getLngLat();
         console.log(lngLat)
         var weatherUrl = 'https://api.openweathermap.org/data/2.5/onecall';
         var weatherOptions = {
             lat: lngLat.lat,
             lon: lngLat.lng,
             appid: OPEN_WEATHER_APPID,
             exclude: 'minutely, current, hourly',
             units: 'imperial'

         };
         $.get(weatherUrl, weatherOptions).done(function (data) {
             console.log(data);
             var cData = '';
             // console.log(data);
             $.each(data.daily, function (index, value) {
                 // console.log(index, value, 'test');
                 var date = new Date(value.dt * 1000);
                 var description = value.weather[0].description;
                 var humidity = value.humidity;
                 var wind = value.wind_speed;
                 var pressure = value.pressure;
                 if (index === 5) {
                     return false
                 }
                 cData += "<div class='col-sm-2'>";
                 cData += "<div class='card'>";
                 cData += "<div class='card-body'>";
                 cData += "<h6 class='card-title'>" + date + "</h6>";
                 cData += "<hr>";
                 cData += "<h6 class='card-text'>" + description + "</h6>";
                 cData += "<h6 class='card-text'>" + 'Humidity: ' + humidity + "</h6>";
                 cData += "<h6 class='card-text'>" + 'Wind: ' + wind + "</h6>";
                 cData += "<h6 class='card-text'>" + 'Pressue: ' + pressure + "</h6>";
                 cData += "</div>";
                 cData += "</div>";
                 cData += "</div>";
                 // console.log(cData)
             });

             $('#weather').append(cData);


             // var date = new Date(data.daily[0].dt * 1000);
             // console.log(date.toLocaleString());
             // console.log(data.daily[0].weather[0].description);
             // console.log(data.daily[0].humidity);
             // console.log(data.daily[0].wind_speed);
             // console.log(data.daily[0].pressure);
         });

     }
    function starterWeather () {
        var weatherUrl = 'https://api.openweathermap.org/data/2.5/onecall';
        var weatherOptions = {
            lat: 30.2672,
            lon: -97.7431,
            appid: OPEN_WEATHER_APPID,
            exclude: 'minutely, current, hourly',
            units: 'imperial'

        };
        $.get(weatherUrl, weatherOptions).done(function (data) {
            console.log(data);
            var cData = '';
            // console.log(data);
            $.each(data.daily, function (index, value) {
                // console.log(index, value, 'test');
                var date = new Date(value.dt * 1000);
                var description = value.weather[0].description;
                var humidity = value.humidity;
                var wind = value.wind_speed;
                var pressure = value.pressure;
                if (index === 5) {
                    return false
                }
                cData += "<div class='col-sm-2'>";
                cData += "<div class='card'>";
                cData += "<div class='card-body'>";
                cData += "<h6 class='card-title'>" + date + "</h6>";
                cData += "<hr>";
                cData += "<h6 class='card-text'>" + description + "</h6>";
                cData += "<h6 class='card-text'>" + 'Humidity: ' + humidity + "</h6>";
                cData += "<h6 class='card-text'>" + 'Wind: ' + wind + "</h6>";
                cData += "<h6 class='card-text'>" + 'Pressue: ' + pressure + "</h6>";
                cData += "</div>";
                cData += "</div>";
                cData += "</div>";
                // console.log(cData)
            });

            $('#weather').append(cData);


            // var date = new Date(data.daily[0].dt * 1000);
            // console.log(date.toLocaleString());
            // console.log(data.daily[0].weather[0].description);
            // console.log(data.daily[0].humidity);
            // console.log(data.daily[0].wind_speed);
            // console.log(data.daily[0].pressure);
        });
    }
    function submitWeather () {
        var weatherUrl = 'https://api.openweathermap.org/data/2.5/onecall';
        var weatherOptions = {
            lat: results[1],
            lon: results[0],
            appid: OPEN_WEATHER_APPID,
            exclude: 'minutely, current, hourly',
            units: 'imperial'

        };

        $.get(weatherUrl, weatherOptions).done(function (data) {
            console.log(data);
            var cData = '';
            // console.log(data);
            $.each(data.daily, function (index, value) {
                // console.log(index, value, 'test');
                var date = new Date(value.dt * 1000);
                var description = value.weather[0].description;
                var humidity = value.humidity;
                var wind = value.wind_speed;
                var pressure = value.pressure;
                if (index === 5) {
                    return false
                }
                cData += "<div class='col-sm-2'>";
                cData += "<div class='card'>";
                cData += "<div class='card-body'>";
                cData += "<h6 class='card-title'>" + date + "</h6>";
                cData += "<hr>";
                cData += "<h6 class='card-text'>" + description + "</h6>";
                cData += "<h6 class='card-text'>" + 'Humidity: ' + humidity + "</h6>";
                cData += "<h6 class='card-text'>" + 'Wind: ' + wind + "</h6>";
                cData += "<h6 class='card-text'>" + 'Pressue: ' + pressure + "</h6>";
                cData += "</div>";
                cData += "</div>";
                cData += "</div>";
                // console.log(cData)
            });

            $('#weather').append(cData);


            // var date = new Date(data.daily[0].dt * 1000);
            // console.log(date.toLocaleString());
            // console.log(data.daily[0].weather[0].description);
            // console.log(data.daily[0].humidity);
            // console.log(data.daily[0].wind_speed);
            // console.log(data.daily[0].pressure);
        });
    }
</script>
</body>
</html>
