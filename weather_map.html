<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css' rel='stylesheet'/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

</head>
<body>

<!--navbar-->
<nav class="navbar bg-primary text-light">Weather App<span id="current-city">city name</span></nav>
<div>
    <div class="mb-2 ml-2">
        <label for="place" class="sr-only">Place</label>
        <input type="text" readonly class="form-control-plaintext" id="place" value="place">
    </div>
    <div class="mx-sm-3 mb-2">
        <label for="input-place" class="sr-only">Submit</label>
        <input type="text" class="form-control" id="input-place">
    </div>
    <button type="submit" id="submit" class="btn btn-primary mb-2">Submit</button>
</div>
<!--cards with weather info-->
<div class="row justify-content-center">
    <div class="col-sm-2">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-title">date</h6>
                <hr>
                <h6 class="card-text">Description:</h6>
                <h6 class="card-text">Humidity:</h6>
                <h6 class="card-text">Wind:</h6>
                <h6 class="card-text">Pressure:</h6>
            </div>
        </div>
    </div>
    <div class="col-sm-2">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-title">date</h6>
                <hr>
                <h6 class="card-text">Description:</h6>
                <h6 class="card-text">Humidity:</h6>
                <h6 class="card-text">Wind:</h6>
                <h6 class="card-text">Pressure:</h6>
            </div>
        </div>
    </div>
    <div class="col-sm-2">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-title">date</h6>
                <hr>
                <h6 class="card-text">Description:</h6>
                <h6 class="card-text">Humidity:</h6>
                <h6 class="card-text">Wind:</h6>
                <h6 class="card-text">Pressure:</h6>
            </div>
        </div>
    </div>
    <div class="col-sm-2">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-title">date</h6>
                <hr>
                <h6 class="card-text">Description:</h6>
                <h6 class="card-text">Humidity:</h6>
                <h6 class="card-text">Wind:</h6>
                <h6 class="card-text">Pressure:</h6>
            </div>
        </div>
    </div>
    <div class="col-sm-2">
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h6 class="card-title">date</h6>
                <hr>
                <h6 class="card-text">Description:</h6>
                <h6 class="card-text">Humidity:</h6>
                <h6 class="card-text">Wind:</h6>
                <h6 class="card-text">Pressure:</h6>
            </div>
        </div>
    </div>
</div>

<!--map-->
<div id='map' class="mt-2" style='width: 100%; height: 500px;'></div>
<!--jquery and keys-->
<script src="js/keys.js"></script>
<script src="js/jquery-2.2.4.js"></script>
<!--mapbox and weather js-->
<script>
    'use strict';
    // map config
    mapboxgl.accessToken = mapboxKey;
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        center: [-97.7431, 30.2672],
        zoom: 9,
    });
    // adding marker
    var marker = new mapboxgl.Marker()
        .setLngLat([-97.7431, 30.2672])
        .addTo(map)
        .setDraggable(true);
    // getting lng and lat of marker
    function onDragEnd () {
        var lngLat = marker.getLngLat();
        reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
                    $('#current-city').text(results);
                    console.log(results);
                });

    }
    marker.on('dragend', function () {
            onDragEnd();
            // $('#current-city').text(reverseGeocode(marker.getLngLat(), mapboxKey));

    });
    // geocode and reverse geocode function
    function geocode(search, token) {
        var baseUrl = 'https://api.mapbox.com';
        var endPoint = '/geocoding/v5/mapbox.places/';
        return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
            .then(function(res) {
                return res.json();
                // to get all the data from the request, comment out the following three lines...
            }).then(function(data) {
                return data.features[0].center;
            });
    }
    function reverseGeocode(coordinates, token) {
        var baseUrl = 'https://api.mapbox.com';
        var endPoint = '/geocoding/v5/mapbox.places/';
        return fetch(baseUrl + endPoint + coordinates.lng + "," + coordinates.lat + '.json' + "?" + 'access_token=' + token)
            .then(function(res) {
                return res.json();
            })
            // to get all the data from the request, comment out the following three lines...
            .then(function(data) {
                return data.features[0].place_name;
            });
    }
    // $('#current-city').on('dragend', function () {
    //     reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
    //         // logs the address for The Alamo
    //         console.log(results);
    //     });
    // });
    reverseGeocode(marker.getLngLat(), mapboxKey).then(function(results) {
                // logs the address for The Alamo
                console.log(results);
            });
    // getting the value of search input
    var searchInput = $('#input-place').keyup(function() {
        var value = $(this).val();
    });
    // geocoding search
    $('#submit').click(function () {
    geocode(searchInput.val(), mapboxKey).then(function(results) {
          // do something with results
        console.log(results);
        map.setCenter(results);
        marker.setLngLat(results);
      });
    });
    // weather js

    var weatherUrl = 'https://api.openweathermap.org/data/2.5/onecall';
    var weatherOptions = {
        lat: 29.4242,
        lon: -98.4936,
        appid: OPEN_WEATHER_APPID,
        exclude: 'minutely, current, hourly',
        units: 'imperial'

    };

    $.get(weatherUrl, weatherOptions).done(function (data) {
        console.log(data);
        console.log(data.daily[1].pressure);
    });

    $.get(weatherUrl, weatherOptions).done(function (data) {
        console.log()
    });
</script>
</body>
</html>
